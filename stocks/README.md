# 股票投资

## todo:
1. 构造pair时，如果比较的字段值相差不大，则不加入pairs；因此，不同的比较字段，就会产生不同的pairs数据集合；


## 一. 预测什么
* 总体来说，需要预测股票未来的涨跌幅，但需要考虑如何选择计算涨跌幅的分子/分母
* 两种场景下的基数(分母)选择：
  * 选股阶段，挑选合适的股票买入，预测相对于 收盘后的第二天开盘价 的涨跌幅。需要考虑A股T+1交易规则的限制，当天买入至少第二天才能卖出。
  * 持有阶段，预测相对于 今日收盘价 的涨跌幅。
* 预测什么价？
  * 做多机制下，主要关注股票的涨幅，而跌幅作为防御指标需要作为选股时的参考？
  * 最高/最低价的极值. 突然的行情，
  * 最高/最低价的均值. 这个不容易受到要预测天数的影响？
* 预测未来几天的? n=1,2,3,5 ... ?
  * 选股阶段，T+1规则下至少是要2天；持股阶段，至少1天；
  * 过多，在拆分数据集时，比较难保证训练集和测试重复？使用均值可以避免这种情况
* 生成的数据格式
  * stock_no,date,
  * future_{buy/hold}_{high/low}_{Xest/mean}_{2(days)}

* 周期
  * 大趋势的判断：7~8年(上证指数的峰值间距？)是一个中国股市牛熊转换的完整周期？ 
  未来2 ~ 3年处在什么位置？
  * 中期：半年
  * 短期： 一周？
* 板块?
* 个股?
* 交易策略：w

## 二、思路
1. 训练模式：采用pair-wise
  * point-wise， 回归问题，绝对的涨跌幅。一般不选择这个
  * pair-wise，pair对二分类问题。根据涨跌幅排序，一般采用这个。
    * 同一交易日，不同股票的pair对比较
    * 同一股票，不同交易日的pair对比较
    * 股票、交易日均不同的比较，是否有价值？
    * pair对的损失值，ndcg作为最终的整体评估指标？
  * list-wise ，整体排序，
2. 数据集的拆分
  * 训练集、验证集、测试集
  * 按交易日为单位，各抽取20支股票为测试集和验证集，剩下部分归为训练集。具体步骤:
    1. 按date+stock,trade_date,stock_no,dataset_type,data的格式生成数据, 导入到sqlite中；
    2. 取所有的trade_date(去重,再单独存一张表)，遍历所有trade_date, 取出该交易日下dataset_type=0的数据，随机抽取20条，更新为测试集；同样操作验证集；
    3. 按天，分别构造三个集合的pair对；对于训练集，再按同一个股票，不同天构造pair对；
  
    


## 三、特征
1. 过去n天的交易数据，n=20，一个月的？
2. 最高价、最低价、开盘价、收盘价、成交量、成交金额
3. 如何归一化，价格取过去1年(4种价格放在一起,仅开盘价?)中位数(可实际看看中位数与均值差别是否较大)？做最大最小值归一；同理，成交量，成交金额类似。
4. 每天的数据归一化后看成一个向量，过去n天数据看成一个矩阵；和RNN/Transformers的输入保持一致；
5. 训练集、验证集、测试集的划分：以要预测的为基准，保证三个集合中不能重复。每周训练一次。历史模型要保留，须做效果回归验证。
6. stock_no,date,base_price,base_x,base_,day20,day19...

1. 统计思路，
    1. 每一只股票全部的最高、最低、中位数、四分数？ 
    1. 一段时间的最高、最低，中位数，四分位数？
    1. 成交量
    1. 成交金额？

ETF？
* [深市ETF](http://www.szse.cn/market/product/list/etfList/index.html)
* [沪市ETF](http://www.sse.com.cn/assortment/fund/etf/list/)
 

1. label如何分档，分几档？
a. 完全平均分，每个层级档位均匀；尝试分10档，20档？  
b. 先平均分4分，top部分再接着分4分?

分6档？
label   分位  high   low
6 75%  0.153396  -0.005885
5 50%  0.108310  -0.016234 
4 25%  0.086307  -0.034516
3 75%  0.07      -0.014298
2 50%  0.03      -0.032202
1 25%  0.01      -0.060422


2. 分组方式
a. 完全随机分组
b. 按日期分组

3. 每组样本构造
如何能找到比较涨幅较高的？

top10,


## 特征
过去20天最高、最低价，距离最高最低家的天数，过去5天收盘价，成交量，成交金额


使用sqlite，按日期、按股票筛选，速度更快些？


## 流程
1. 下载更新数据
2. 训练更新模型、发出评估结论
3. 预测未来一周情况



preprocess.py:105: RuntimeWarning: invalid value encountered in double_scalars
  (df_past.loc[i]['TURNOVER'] - mean_TURNOVER)/mean_TURNOVER)